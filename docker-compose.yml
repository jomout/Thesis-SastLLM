services:
  sastllm_database:
    image: postgres
    container_name: sastllm_db
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
      - pg_sastllm_data:/var/lib/postgresql
      # Load initial schema and triggers on first database initialization
      - ./database/00__init.sql:/docker-entrypoint-initdb.d/00__init.sql:ro
      - ./database/01__triggers.sql:/docker-entrypoint-initdb.d/01__triggers.sql:ro
    restart: unless-stopped

  sastllm_qdrant:
    image: qdrant/qdrant
    container_name: sastllm_qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./qdrant_storage:/qdrant/storage
    environment:
      QDRANT__STORAGE__STORAGE_PATH: "/qdrant/storage"
      QDRANT__SERVICE__HTTP_PORT: 6333
      QDRANT__SERVICE__GRPC_PORT: 6334

volumes:
  pg_sastllm_data:
